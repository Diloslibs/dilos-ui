<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Table | Dilos</title>

  <!-- Script CSS Dilos -->
  <link rel="stylesheet" href="./../../libs/dist/index.css">

  <!-- Tailwind Integration -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <div class="my-0 mx-auto min-h-full max-w-screen-md py-16">
    <div class="flex flex-col gap-5">
      <div class="flex flex-col gap-3">
        <h1 class="text-2xl font-bold">Minimal Configuration To Run!</h1>

        <div class="bg-white p-4 border rounded-md">
          <table id="d-table" class="d-table d-table-responsive"></table>
        </div>

      </div>
    </div>
  </div>

  <!-- Script JS Dilos -->
  <script src="./../../libs/dist/index.js"></script>
  <script type="module">
    const options = {
      data: [],
      limit: 10,
      total: 100,
      page: 1,
    };

    async function fetchData(page = 1, limit = 10) {
      const response = await fetch(`https://dummyjson.com/products?limit=${limit}&skip=${(page - 1) * limit}`);
      const res = await response.json();

      options.data = res.products;
      options.total = res.total;
      options.limit = res.limit;

      return {
        data: options.data,
        total: options.total,
      };
    }

    async function searchData(page = 1, limit = 10, q = "") {
      const response = await fetch(`https://dummyjson.com/products/search?q=${q}&limit=${limit}`);
      const res = await response.json();

      options.data = res.products;
      options.total = res.total;

      return {
        data: options.data,
        total: options.total,
      };
    }

    await fetchData();

    const table = new DTable("d-table", {
      columns: [
        {
          title: "Id",
          selector: "id",
        },
        {
          title: "Title",
          selector: "title",
        },
        {
          title: "Description",
          selector: "description",
        },
      ],
      data: options.data,
      pagination: {
        serverSide: true,
        perPage: options.limit,
        totalData: options.total,
        page: options.page,
        nextPage: async () => {
          options.page++;
          const { data, total } = await fetchData(options.page, options.limit);
          table.updatePaginationSSR(data, total, options.page);
        },
        prevPage: async () => {
          options.page--;
          const { data, total } = await fetchData(options.page, options.limit);
          table.updatePaginationSSR(data, total, options.page);
        },
        firstPage: async () => {
          options.page = 1;

          const { data, total } = await fetchData(options.page, options.limit);
          table.updatePaginationSSR(data, total, options.page);
        },
        lastPage: async () => {
          options.page = Math.ceil(options.total / options.limit);

          const { data, total } = await fetchData(options.page, options.limit);
          table.updatePaginationSSR(data, total, options.page);
        },
        goToPage: async (page) => {
          options.page = page;

          const { data, total } = await fetchData(options.page, options.limit);
          table.updatePaginationSSR(data, total, options.page);
        },
        changeLimit: async (limit) => {
          options.limit = limit;
          options.page = 1;

          const { data, total } = await fetchData(options.page, options.limit);
          table.updatePaginationSSR(data, total, options.page);
        },
        searchQuery: async (q) => {
          let data = [];
          let total = 0;

          if (!q) {
            const res = await fetchData(options.page, options.limit);
            data = res.data
            total = res.total
          }
          else {
            const res = await searchData(options.page, options.limit, q);
            data = res.data
            total = res.total
          }
          table.updatePaginationSSR(data, total, options.page);

          return {
            data,
            total,
          };
        }
      },
    });
  </script>
</body>

</html>